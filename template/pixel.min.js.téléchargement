(()=>{var D=Object.defineProperty;var L=(i,t,e)=>t in i?D(i,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):i[t]=e;var O=(i,t)=>()=>(t||i((t={exports:{}}).exports,t),t.exports);var b=(i,t,e)=>(L(i,typeof t!="symbol"?t+"":t,e),e),P=(i,t,e)=>{if(!t.has(i))throw TypeError("Cannot "+e)};var a=(i,t,e)=>(P(i,t,"read from private field"),e?e.call(i):t.get(i)),u=(i,t,e)=>{if(t.has(i))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(i):t.set(i,e)};var d=(i,t,e)=>(P(i,t,"access private method"),e);var m=O((_,z)=>{var H=class{constructor(t){this.schema=t}sanitize(t){return this.#t(t,this.schema)}#t(t,e){if(Array.isArray(e))return this.#n(t,e);if(e===String)return t?.toString();if(e===Number)return Number(t);if(e===Boolean)return!["0","false"].includes(t.toString());if(typeof e=="object")return this.#e(t,e);throw new Error(`Don't know how to sanitize ${typeof e} specified in schema`)}#e(t,e){return Object.keys(e).filter(n=>e.hasOwnProperty(n)&&t.hasOwnProperty(n)).reduce((n,r)=>(n[r]=this.#t(t[r],e[r]),n),{})}#n(t,e){if(e.length!==1)throw new Error("Schema arrays must contain exactly one type of field");return t.map(n=>this.#t(n,e[0]))}};z.exports=H});var q=O((X,R)=>{var g=m(),S,E,A,w,p,f,I,h,y,C,N,M,v,o=class{constructor(){u(this,h);u(this,C);u(this,M)}conf(t,e=!0,n=!1){if(this.token&&this.token.length){console.log("MAI SDK already configured; skipping reconfiguration.");return}this.token=t,this.restricted=n,this.onboardingSync=this.restricted?!1:e,this.host=n?o.RESTRICTED_PIXEL_HOST:o.PIXEL_HOST,this.debug=!1,this.ready=new Promise((r,s)=>{let l=new XMLHttpRequest;l.open("GET",`${this.host}/init`,!0),l.withCredentials=!0,l.onload=r,l.onerror=s,l.send()}),this.onboardingSync&&this.ready.then(()=>{let r=new Image;r.src=`${this.host}/pixel/sync.gif`})}identify(t){return d(this,h,y).call(this,"identify",{userId:t.toString()})}view(){return d(this,h,y).call(this,"view",{url:window.location.href})}lead(t,e,n={}){let r={...n,value:t,currency:e},s=new g(a(o,A));return d(this,h,y).call(this,"lead",s.sanitize(r))}product(t,e,n={}){let r={...n,value:t,currency:e},s=new g(a(o,w));return d(this,h,y).call(this,"product",s.sanitize(r))}addToCart(t,e,n,r={}){let s={...r,value:t,currency:e,quantity:n},l=new g(a(o,p));return d(this,h,y).call(this,"add_to_cart",l.sanitize(s))}checkout(t,e,n={}){let r={...n,value:t,currency:e},s=new g(a(o,f));return d(this,h,y).call(this,"checkout",s.sanitize(r))}code(t,e){return d(this,h,y).call(this,"code",{code:t.toString(),type:e.toString()})}purchase(t,e,n,r={}){let s={...r,value:t,currency:e,id:n},l=new g(a(o,I));return d(this,h,y).call(this,"purchase",l.sanitize(s))}emit(t,...e){if(!!["conf","view","identify","lead","product","addToCart","checkout","code","purchase"].includes(t))return this[t](...e)}},c=o;S=new WeakMap,E=new WeakMap,A=new WeakMap,w=new WeakMap,p=new WeakMap,f=new WeakMap,I=new WeakMap,h=new WeakSet,y=function(t,e){if(!this.token||!this.token.length)throw new Error("MAI SDK has not been configured. Call conf() first.");return this.ready.then(()=>{let n={...e,token:this.token,referrer:window.document.referrer};this.debug&&console.log("Sending sanitized payload:",n);let r=new XMLHttpRequest;r.open("POST",`${this.host}/${t}`,!0),r.setRequestHeader("Content-Type","application/json"),r.withCredentials=!0,r.onload=d(this,C,N),r.onerror=d(this,M,v),r.send(JSON.stringify(n))})},C=new WeakSet,N=function(){this.debug&&console.log("OK")},M=new WeakSet,v=function(t){this.debug&&console.log("XHR error:",t)},b(c,"PIXEL_HOST","https://mgln.ai"),b(c,"RESTRICTED_PIXEL_HOST","https://r.mgln.ai"),u(c,S,{value:Number,currency:String}),u(c,E,{productId:String,productName:String,productType:String,productVendor:String,variantId:String,variantName:String}),u(c,A,{...a(o,S),id:String,productId:String,quantity:Number,type:String,category:String}),u(c,w,{...a(o,S),...a(o,E)}),u(c,p,{...a(o,w),quantity:Number}),u(c,f,{...a(o,S),quantity:Number,discountCode:String,id:String,lineItems:[a(o,p)]}),u(c,I,{...a(o,f),isNewCustomer:Boolean});R.exports=c});var T=q();if(window.MAI===void 0){let i=document.currentScript,t=i.dataset,e=new URL(i.src).searchParams,n=t.hasOwnProperty("token")?t.token:e.get("token"),r=t.hasOwnProperty("onboardingSync")?t.onboardingSync!=="false":e.get("onboarding_sync")!=="false",s=t.hasOwnProperty("restricted")?t.restricted==="true":e.get("restricted")==="true";window.MAI=new T,window.MAI.conf(n,r,s)}else if(Array.isArray(window.MAI.q)){let i=window.MAI.q;window.MAI=new T,i.sort((t,e)=>(t[0]==="conf"?0:1)-(e[0]==="conf"?0:1)).forEach(t=>window.MAI.emit(...t))}})();
